<?xml version="1.0" encoding="UTF-8"?>
<!--
  ~ Copyright 2013 Pykhov Gregory
  ~
  ~
  -->

<map:cfg
        xmlns:l="http://s1-platform.org/config/types/Long"
        xmlns:i="http://s1-platform.org/config/types/Integer"
        xmlns:f="http://s1-platform.org/config/types/Float"
        xmlns:d="http://s1-platform.org/config/types/Double"
        xmlns:bd="http://s1-platform.org/config/types/BigDecimal"
        xmlns:bi="http://s1-platform.org/config/types/BigInteger"
        xmlns:dt="http://s1-platform.org/config/types/Date"
        xmlns:b="http://s1-platform.org/config/types/Boolean"
        xmlns:map="http://s1-platform.org/config/types/Map"
        xmlns:list="http://s1-platform.org/config/types/List"

        collection="coll1"
        class="org.s1.mongodb.table.MongoDBTable"
        >

    <map:schema>
        <list:attributes>
            <map:e name="a" label="aaa" type="String" appearance="required"></map:e>
            <map:e name="b" label="bbb" type="Integer" appearance="normal"></map:e>
        </list:attributes>
    </map:schema>

    <enrichRecord><![CDATA[
            //enrich
            ]]></enrichRecord>

    <prepareSearch><![CDATA[
            //prepare search
            ]]></prepareSearch>

    <prepareSort><![CDATA[
            //prepare sort
            ]]></prepareSort>

    <access><![CDATA[
        return true
        ]]></access>

    <importAccess><![CDATA[
        return true
            ]]></importAccess>

    <logAccess><![CDATA[
        return true
            ]]></logAccess>

    <map:importSchema>
        <list:attributes>
            <map:e name="a" label="imp_aaa" type="String" appearance="required"></map:e>
            <map:e name="b" label="inp_bbb" type="Integer" appearance="normal"></map:e>
        </list:attributes>
    </map:importSchema>

    <importAction><![CDATA[
            newRecord._state="present";
            ]]></importAction>

    <list:actions>
        <map:e name="add" label="Add" to="present">
            <access><![CDATA[
                    ]]></access>
            <before><![CDATA[
                    ]]></before>
            <after><![CDATA[
                    ]]></after>
            <map:schema>
                <list:attributes>
                    <map:e name="a" label="aaa" type="String" appearance="required"></map:e>
                    <map:e name="b" label="bbb" type="Integer" appearance="normal"></map:e>
                </list:attributes>
            </map:schema>
        </map:e>
        <map:e name="setB" label="Set b" from="present" to="present" b:log="true">
            <access><![CDATA[
                    ]]></access>
            <before><![CDATA[
                    ]]></before>
            <after><![CDATA[
                    ]]></after>
            <merge><![CDATA[
                    s1.clear(newRecord);
                    newRecord.a = oldRecord.a;
                    newRecord.b = data.b1;
                    ]]></merge>
            <map:schema>
                <list:attributes>
                    <map:e name="b1" label="bbb1" type="Integer" appearance="normal"></map:e>
                </list:attributes>
            </map:schema>
            <map:foundationSchema>
                <list:attributes>
                    <map:e name="comment" label="Comment" type="String" appearance="required"></map:e>
                </list:attributes>
            </map:foundationSchema>

        </map:e>
        <map:e name="remove" label="Remove" from="present" b:log="true">
            <access><![CDATA[
                    return true
                    ]]></access>
            <before><![CDATA[
                    //some actions
                    ]]></before>
            <after><![CDATA[
                    //some actions
                    ]]></after>
            <map:foundationSchema>
                <list:attributes>
                    <map:e name="number" label="Doc number" type="String" appearance="required"></map:e>
                </list:attributes>
            </map:foundationSchema>
        </map:e>
    </list:actions>

    <list:states>
        <map:e name="present" label="Present"></map:e>
    </list:states>

    <list:indexes>
        <map:e b:unique="true">
            <list:fields>
                <e>a</e>
            </list:fields>
        </map:e>
    </list:indexes>

    <map:fullText language="english">
        <list:fields>
            <e>a</e>
            <e>b</e>
        </list:fields>
    </map:fullText>

</map:cfg>